# 前端服务层扩展架构方案 (参考后端模式)

## 架构目录结构

```
src/services/
├── core/                           # 核心服务层
│   ├── api-client.js              # HTTP客户端封装
│   ├── service-registry.js        # 服务注册和依赖管理
│   └── error-handler.js           # 全局错误处理服务
│
├── auth/                          # 认证服务层
│   ├── auth-service.js            # 认证核心服务
│   └── permission-service.js      # 权限管理服务
│
├── user/                          # 用户数据服务层
│   ├── user-service.js            # 用户信息服务
│   ├── user-settings-service.js   # 用户设置服务
│   ├── user-favorites-service.js  # 收藏管理服务
│   └── user-history-service.js    # 历史记录服务
│
├── search/                        # 搜索服务层
│   ├── search-service.js          # 搜索引擎服务
│   ├── search-sources-service.js  # 搜索源管理服务
│   └── source-checker-service.js  # 搜索源状态检查服务
│
├── community/                     # 社区服务层
│   ├── community-service.js       # 社区统计和概览服务
│   ├── community-sources-service.js # 社区搜索源服务
│   └── community-tags-service.js  # 社区标签服务
│
└── system/                        # 系统服务层
    ├── theme-service.js           # 主题管理服务
    ├── notification-service.js    # 通知服务
    └── cache-service.js           # 缓存管理服务
```

## 各服务模块职责划分

### 🏗️ Core 核心服务层

#### `api-client.js` - HTTP客户端
```javascript
class APIClient {
  // 基础HTTP请求封装
  async request(endpoint, options = {})
  async get(endpoint, params = {})
  async post(endpoint, data = {})
  async put(endpoint, data = {})
  async delete(endpoint)
  
  // 请求拦截和重试
  setupInterceptors()
  setupRetryMechanism()
  
  // Token管理
  setToken(token)
  clearToken()
}
```

#### `service-registry.js` - 服务注册器
```javascript
class ServiceRegistry {
  // 服务注册和获取
  register(name, service)
  get(serviceName)
  
  // 依赖注入管理
  injectDependencies(service)
  
  // 服务生命周期
  initialize()
  destroy()
}
```

#### `error-handler.js` - 错误处理服务
```javascript
class ErrorHandler {
  // 全局错误处理
  handleAPIError(error)
  handleNetworkError(error)
  
  // 错误恢复机制
  setupErrorRecovery()
  retryFailedRequest(request)
}
```

### 🔐 Auth 认证服务层

#### `auth-service.js` - 认证服务
```javascript
class AuthService {
  // 认证操作
  async login(username, password)
  async register(userData)
  async logout()
  
  // Token管理
  async verifyToken()
  async refreshToken()
  
  // 认证状态
  isAuthenticated()
  getCurrentUser()
}
```

#### `permission-service.js` - 权限服务
```javascript
class PermissionService {
  // 权限检查
  hasPermission(permission)
  requireAuth(message)
  
  // 用户角色
  isAdmin()
  isPremiumUser()
  
  // 权限验证
  validateUserAction(action)
}
```

### 👤 User 用户服务层

#### `user-service.js` - 用户信息服务
```javascript
class UserService {
  // 用户信息管理
  async getUserProfile()
  async updateProfile(data)
  async changePassword(oldPassword, newPassword)
  async deleteAccount()
  
  // 用户统计
  async getUserStats()
}
```

#### `user-settings-service.js` - 用户设置服务
```javascript
class UserSettingsService {
  // 设置管理
  async getSettings()
  async updateSettings(settings)
  async resetSettings()
  
  // 设置分类
  async getSearchSettings()
  async getUISettings()
  async getPrivacySettings()
}
```

#### `user-favorites-service.js` - 收藏服务
```javascript
class UserFavoritesService {
  // 收藏管理
  async getFavorites()
  async addFavorite(item)
  async removeFavorite(itemId)
  async syncFavorites()
  
  // 收藏分类
  async getFavoritesByCategory(category)
  async createCategory(name)
}
```

#### `user-history-service.js` - 历史记录服务
```javascript
class UserHistoryService {
  // 历史记录
  async getSearchHistory()
  async addToHistory(query)
  async deleteHistoryItem(id)
  async clearAllHistory()
  
  // 历史统计
  async getSearchStats()
  async getTopQueries()
}
```

### 🔍 Search 搜索服务层

#### `search-service.js` - 搜索引擎服务
```javascript
class SearchService {
  // 搜索执行
  async performSearch(keyword, options)
  async buildSearchResults(keyword, options)
  
  // 搜索优化
  getSearchSuggestions(query, history)
  async warmupCache(keywords)
  
  // 结果处理
  processSearchResults(results)
  sortResultsByRelevance(results)
}
```

#### `search-sources-service.js` - 搜索源管理服务
```javascript
class SearchSourcesService {
  // 搜索源管理
  async getEnabledSources()
  async addCustomSource(source)
  async updateSource(sourceId, updates)
  async deleteSource(sourceId)
  
  // 搜索源配置
  async getSourceCategories()
  async importSources(sources)
  async exportSources()
}
```

#### `source-checker-service.js` - 状态检查服务
```javascript
class SourceCheckerService {
  // 状态检查
  async checkSourceStatus(source, userSettings)
  async checkMultipleSources(sources, userSettings)
  
  // 检查管理
  async checkAllSourcesStatus()
  async getStatusHistory()
  
  // 缓存管理
  clearCache()
  warmupCache(sources)
}
```

### 🏘️ Community 社区服务层

#### `community-service.js` - 社区统计服务
```javascript
class CommunityService {
  // 社区统计
  async getCommunityStats()
  async getUserCommunityStats()
  
  // 社区搜索
  async searchCommunityContent(query, options)
  
  // 社区动态
  async getRecentActivity()
  async getTrendingContent()
}
```

#### `community-sources-service.js` - 社区搜索源服务
```javascript
class CommunitySourcesService {
  // 搜索源分享
  async getCommunitySearchSources(options)
  async shareSourceToCommunity(sourceData)
  async downloadCommunitySource(sourceId)
  
  // 搜索源互动
  async likeSource(sourceId)
  async reviewSource(sourceId, reviewData)
  async reportSource(sourceId, reportData)
  
  // 搜索源管理
  async editCommunitySource(sourceId, updates)
  async deleteCommunitySource(sourceId)
}
```

#### `community-tags-service.js` - 社区标签服务
```javascript
class CommunityTagsService {
  // 标签管理
  async getAllTags(options)
  async createTag(tagData)
  async updateTag(tagId, updates)
  async deleteTag(tagId)
  
  // 标签使用
  async getPopularTags(category)
  async getTagDetails(tagId)
  
  // 批量操作
  async batchUpdateTagsStatus(tagIds, isActive)
}
```

### ⚙️ System 系统服务层

#### `theme-service.js` - 主题服务
```javascript
class ThemeService {
  // 主题管理
  setTheme(theme)
  toggleTheme()
  getCurrentTheme()
  
  // 主题检测
  detectSystemTheme()
  applyAutoTheme()
  listenToSystemTheme()
}
```

#### `notification-service.js` - 通知服务
```javascript
class NotificationService {
  // 通知显示
  showToast(message, type, duration)
  showModal(title, content, options)
  
  // 通知管理
  addNotification(notification)
  removeNotification(id)
  clearAllNotifications()
  
  // 通知设置
  setNotificationSettings(settings)
}
```

#### `cache-service.js` - 缓存服务
```javascript
class CacheService {
  // 缓存操作
  set(key, value, ttl)
  get(key)
  delete(key)
  clear()
  
  // 缓存策略
  setupCachePolicy(policy)
  cleanupExpiredCache()
  
  // 缓存统计
  getCacheStats()
  getCacheSize()
}
```

## 服务间依赖关系

```
AuthService ← UserService, UserSettingsService, UserFavoritesService, UserHistoryService
APIClient ← 所有需要HTTP请求的服务
CacheService ← SearchService, CommunityService
ThemeService → NotificationService
ServiceRegistry → 所有服务 (依赖注入)
```

## 迁移映射

### 从现有文件到新架构：

**api.js** 拆分为：
- `core/api-client.js` (HTTP客户端)
- `core/error-handler.js` (错误处理)
- `user/user-service.js` (用户相关API)
- `user/user-settings-service.js` (设置API)
- `user/user-favorites-service.js` (收藏API)
- `user/user-history-service.js` (历史API)

**auth.js** 拆分为：
- `auth/auth-service.js` (认证核心)
- `auth/permission-service.js` (权限管理)

**search.js** 拆分为：
- `search/search-service.js` (搜索引擎)
- `search/search-sources-service.js` (搜索源管理)

**enhanced-source-checker.js** 重构为：
- `search/source-checker-service.js`

**community-sources-api.js** 重构为：
- `community/community-sources-service.js`

**community-tags-api.js** 重构为：
- `community/community-tags-service.js`

**theme.js** 重构为：
- `system/theme-service.js`

**新增服务**：
- `core/service-registry.js` (服务管理)
- `community/community-service.js` (社区统计)
- `system/notification-service.js` (通知系统)
- `system/cache-service.js` (缓存管理)

## 优势

1. **模块化**: 每个服务职责单一，便于维护
2. **可扩展**: 新功能可以独立添加新服务
3. **依赖清晰**: 服务间依赖关系明确
4. **测试友好**: 每个服务可以独立测试
5. **团队协作**: 不同开发者可以并行开发不同模块