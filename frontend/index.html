<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ç£åŠ›å¿«æœ - ä¸“ä¸šç‰ˆ</title>
    <meta name="description" content="ä¸“ä¸šçš„ç£åŠ›æœç´¢å·¥å…·ï¼Œæ”¯æŒäº‘ç«¯åŒæ­¥ï¼Œæ™ºèƒ½æœç´¢ï¼Œè¯¦æƒ…æå–">
	
    <!-- æ ¸å¿ƒæ ·å¼ - å¿…é¡»æœ€å…ˆå¼•å…¥ -->
    <link rel="stylesheet" href="css/core/variables.css">
    <link rel="stylesheet" href="css/core/base.css">
    
    <!-- ç»„ä»¶æ ·å¼ - æŒ‰ä¾èµ–é¡ºåºå¼•å…¥ -->
    <link rel="stylesheet" href="css/components/navbar.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/toast.css">
    <link rel="stylesheet" href="css/components/loading.css">
    <link rel="stylesheet" href="css/components/search.css">
	<link rel="stylesheet" href="css/components/detail-card.css">
    <link rel="stylesheet" href="css/components/status.css">
    <link rel="stylesheet" href="css/components/search-status.css">
    
    <!-- ä¸»é¡µä¸“ç”¨æ ·å¼ -->
    <link rel="stylesheet" href="css/pages/main.css">
    
    <!-- å·¥å…·æ ·å¼ - æœ€åå¼•å…¥ -->
    <link rel="stylesheet" href="css/utils/animations.css">
    <link rel="stylesheet" href="css/utils/responsive.css">
    <link rel="stylesheet" href="css/utils/accessibility.css">
    <link rel="stylesheet" href="css/utils/print.css">
	
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    
    <!-- è¯¦æƒ…æå–åŠŸèƒ½æ”¯æŒçš„metaæ ‡ç­¾ -->
    <meta name="detail-extraction-supported" content="true">
    <meta name="detail-extraction-version" content="2.0.0">
    <meta name="detail-extraction-features" content="batch,progress,cache,retry,filter">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="./index.html">
                    <img src="images/logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
                    <span class="brand-text" id="brand-text">ç£åŠ›å¿«æœ</span>
                </a>
            </div>
            <div class="nav-menu">
                <button id="themeToggle" class="theme-btn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
                
                <!-- è¯¦æƒ…æå–åŠŸèƒ½åˆ‡æ¢æŒ‰é’® -->
                <button id="detailExtractionToggle" class="detail-extraction-btn" title="åˆ‡æ¢è¯¦æƒ…æå–åŠŸèƒ½" style="display:none;">
                    <span class="btn-icon">ğŸ”‹</span>
                    <span class="btn-text">è¯¦æƒ…æå–</span>
                </button>
                
                <!-- è¯¦æƒ…æå–è®¾ç½®æŒ‰é’® -->
                <button id="detailSettingsBtn" class="detail-settings-btn" title="è¯¦æƒ…æå–è®¾ç½®" style="display:none;" onclick="openDetailSettings()">
                    <span class="btn-icon">âš™ï¸</span>
                </button>
                
                <div id="userMenu" class="user-menu">
                    <button id="loginBtn" class="login-btn">ç™»å½•</button>
                    <div id="userInfo" class="user-info" style="display:none;">
                        <span id="username" class="username"></span>
                        <div class="dropdown">
                            <button class="dropdown-btn" title="ç”¨æˆ·èœå•">â–¼</button>
                            <div class="dropdown-content">
                                <a href="#" onclick="navigateToDashboard(); return false;">ä¸ªäººä¸­å¿ƒ</a>
                                <a href="#" onclick="openDetailSettings(); return false;" id="detailSettingsLink" style="display:none;">è¯¦æƒ…è®¾ç½®</a>
                                <a href="#" id="logoutBtn">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content" style="display:none;">
        <!-- HeroåŒºåŸŸ -->
        <section class="hero">
            <h1 class="hero-title" id="hero-title">ç£åŠ›å¿«æœ - ä¸“ä¸šç‰ˆ</h1>
            <p class="hero-subtitle">æ™ºèƒ½æœç´¢ï¼Œäº‘ç«¯åŒæ­¥ï¼Œæè‡´ä½“éªŒ</p>
            
            <!-- æœç´¢æ¡† -->
            <div class="search-container">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input" 
                        placeholder="è¯·è¾“å…¥ç•ªå·æˆ–å…³é”®è¯" 
                        autocomplete="off"
                        maxlength="100"
                    >
                    <button id="searchBtn" class="search-btn" title="æœç´¢">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <span>æœç´¢</span>
                    </button>
                </div>
                
                <!-- é«˜çº§æœç´¢é€‰é¡¹ -->
                <div class="search-options" style="display:none;">
                    <div class="options-row">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableDetailExtraction" disabled>
                            <span>è‡ªåŠ¨æå–è¯¦æƒ…</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableSourceStatus" disabled>
                            <span>æ£€æŸ¥æºçŠ¶æ€</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableContentFilter" disabled>
                            <span>å†…å®¹è¿‡æ»¤</span>
                        </label>
                    </div>
                    <div class="options-row">
                        <label for="extractionMode">æå–æ¨¡å¼:</label>
                        <select id="extractionMode" class="option-select" disabled>
                            <option value="auto">è‡ªåŠ¨æå–</option>
                            <option value="manual">æ‰‹åŠ¨æå–</option>
                            <option value="selective">é€‰æ‹©æ€§æå–</option>
                            <option value="smart">æ™ºèƒ½æå–</option>
                        </select>
                        <label for="extractionQuality">æå–è´¨é‡:</label>
                        <select id="extractionQuality" class="option-select" disabled>
                            <option value="high">é«˜è´¨é‡</option>
                            <option value="balanced">å¹³è¡¡</option>
                            <option value="fast">å¿«é€Ÿ</option>
                        </select>
                    </div>
                </div>
                
                <!-- æœç´¢é€‰é¡¹åˆ‡æ¢æŒ‰é’® -->
                <button id="toggleSearchOptions" class="toggle-options-btn" title="æ˜¾ç¤º/éšè—é«˜çº§é€‰é¡¹">
                    <span class="btn-icon">âš™ï¸</span>
                    <span class="btn-text">é«˜çº§é€‰é¡¹</span>
                </button>
            </div>
        </section>

        <!-- å¿«é€Ÿæç¤º -->
        <section id="quickTips" class="quick-tips" style="display:none;">
            <div class="tips-content">
                <h3>ğŸ’¡ æœç´¢æŠ€å·§</h3>
                <ul>
                    <li>è¾“å…¥å®Œæ•´ç•ªå·è·å¾—æœ€ç²¾ç¡®ç»“æœ</li>
                    <li>ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¤šä¸ªå…³é”®è¯</li>
                    <li>ç™»å½•åå¯äº«å—äº‘ç«¯åŒæ­¥æœåŠ¡</li>
                    <li>æ”¯æŒè¯¦æƒ…æå–çš„ç«™ç‚¹ä¼šæ˜¾ç¤º ğŸ”‹ æ ‡è¯†</li>
                    <li>ä½¿ç”¨é«˜çº§é€‰é¡¹è‡ªå®šä¹‰æœç´¢å’Œæå–è¡Œä¸º</li>
                </ul>
            </div>
        </section>

        <!-- è¯¦æƒ…æå–åŠŸèƒ½çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆå¢å¼ºç‰ˆï¼‰ -->
        <section id="detailExtractionStatus" class="detail-extraction-status" style="display:none;">
            <div class="status-content">
                <div class="status-header">
                    <span class="status-icon">ğŸ”‹</span>
                    <span class="status-text">è¯¦æƒ…æå–åŠŸèƒ½</span>
                    <span class="status-badge" id="detailStatusBadge">æœªå¯ç”¨</span>
                    <div class="status-actions">
                        <button id="detailStatusRefresh" class="status-action-btn" title="åˆ·æ–°çŠ¶æ€">ğŸ”„</button>
                        <button id="detailStatusSettings" class="status-action-btn" title="è®¾ç½®" onclick="openDetailSettings()">âš™ï¸</button>
                    </div>
                </div>
                <div class="status-description" id="detailStatusDescription">
                    è¯¦æƒ…æå–åŠŸèƒ½å¯ä»¥è‡ªåŠ¨è·å–ç•ªå·çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å°é¢å›¾ç‰‡ã€æ¼”å‘˜ä¿¡æ¯ã€ä¸‹è½½é“¾æ¥ç­‰ã€‚
                </div>
                <div class="status-stats" id="detailStatusStats" style="display:none;">
                    <div class="stat-item">
                        <span class="stat-label">æ”¯æŒæºæ•°é‡:</span>
                        <span class="stat-value" id="supportedSourcesCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ€»æå–æ¬¡æ•°:</span>
                        <span class="stat-value" id="totalExtractionsCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æˆåŠŸç‡:</span>
                        <span class="stat-value" id="extractionSuccessRate">0%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç¼“å­˜å‘½ä¸­ç‡:</span>
                        <span class="stat-value" id="cacheHitRate">0%</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- æœç´¢çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <section id="searchStatusIndicator" class="search-status-indicator" style="display:none;">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° -->
        </section>

        <!-- è¯¦æƒ…æå–è¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆå¢å¼ºç‰ˆï¼‰ -->
        <section id="detailExtractionProgress" class="detail-extraction-progress" style="display:none;">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° -->
        </section>

        <!-- æ™ºèƒ½æå–å»ºè®®ï¼ˆæ–°å¢ï¼‰ -->
        <section id="extractionSuggestions" class="extraction-suggestions" style="display:none;">
            <div class="suggestions-header">
                <h3>ğŸ¤– æ™ºèƒ½æå–å»ºè®®</h3>
                <button class="suggestions-close" onclick="this.parentElement.parentElement.style.display='none'">Ã—</button>
            </div>
            <div class="suggestions-content" id="suggestionsContent">
                <!-- å»ºè®®å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- æœç´¢å†å² -->
        <section id="historySection" class="history-section" style="display:none;">
            <div class="section-header">
                <h2>ğŸ•’ æœç´¢å†å²</h2>
                <div class="section-actions">
                    <button id="clearHistoryBtn" class="clear-btn">æ¸…ç©ºå†å²</button>
                    <button id="exportHistoryBtn" class="action-btn" style="display:none;">å¯¼å‡ºå†å²</button>
                </div>
            </div>
            <div id="historyList" class="history-list"></div>
        </section>

        <!-- æœç´¢ç»“æœ -->
        <section id="resultsSection" class="results-section" style="display:none;">
            <div class="section-header">
                <h2>ğŸ” æœç´¢ç»“æœ</h2>
                <div class="section-actions">
                    <!-- è¯¦æƒ…æå–æ§åˆ¶æŒ‰é’® -->
                    <button id="batchExtractBtn" class="action-btn detail-action-btn" style="display:none;">
                        <span class="btn-icon">ğŸ”‹</span>
                        <span class="btn-text">æ‰¹é‡æå–</span>
                    </button>
                    <button id="smartExtractBtn" class="action-btn smart-action-btn" style="display:none;">
                        <span class="btn-icon">ğŸ¤–</span>
                        <span class="btn-text">æ™ºèƒ½æå–</span>
                    </button>
                    <button id="cancelExtractionBtn" class="action-btn cancel-action-btn" style="display:none;">
                        <span class="btn-icon">â¹ï¸</span>
                        <span class="btn-text">å–æ¶ˆæå–</span>
                    </button>
                    <button id="refreshStatusBtn" class="action-btn status-action-btn" style="display:none;">
                        <span class="btn-icon">ğŸ”„</span>
                        <span class="btn-text">åˆ·æ–°çŠ¶æ€</span>
                    </button>
                    <button id="exportResultsBtn" class="action-btn" style="display:none;">å¯¼å‡ºç»“æœ</button>
                    <button id="clearResultsBtn" class="clear-btn">æ¸…ç©ºç»“æœ</button>
                </div>
            </div>
            <div id="searchInfo" class="search-info"></div>
            
            <!-- è¯¦æƒ…æå–ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¢å¼ºç‰ˆï¼‰ -->
            <div id="detailExtractionStats" class="detail-extraction-stats" style="display:none;">
                <div class="stats-content">
                    <div class="stats-row">
                        <span class="stats-item">
                            <span class="stats-label">æ”¯æŒè¯¦æƒ…æå–:</span>
                            <span class="stats-value" id="supportedCount">0</span>
                        </span>
                        <span class="stats-item">
                            <span class="stats-label">å·²æå–:</span>
                            <span class="stats-value" id="extractedCount">0</span>
                        </span>
                        <span class="stats-item">
                            <span class="stats-label">æå–æˆåŠŸç‡:</span>
                            <span class="stats-value" id="successRate">0%</span>
                        </span>
                        <span class="stats-item">
                            <span class="stats-label">å¹³å‡æ—¶é—´:</span>
                            <span class="stats-value" id="averageTime">0ms</span>
                        </span>
                    </div>
                    <div class="stats-progress">
                        <div class="progress-label">æ•´ä½“è¿›åº¦</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="progressText">0/0</div>
                    </div>
                </div>
            </div>
            
            <div id="results" class="results-grid"></div>
        </section>

        <!-- æ”¶è—å¤¹ -->
        <section class="favorites-section">
            <div class="section-header">
                <h2>â­ æˆ‘çš„æ”¶è—</h2>
                <div class="section-actions">
                    <button id="syncFavoritesBtn" class="sync-btn" style="display:none;">åŒæ­¥æ”¶è—</button>
                    <button id="importFavoritesBtn" class="action-btn" style="display:none;">å¯¼å…¥æ”¶è—</button>
                    <button id="exportFavoritesBtn" class="action-btn" style="display:none;">å¯¼å‡ºæ”¶è—</button>
                </div>
            </div>
            <div class="favorites-controls" style="display:none;">
                <div class="controls-row">
                    <input type="text" id="favoritesSearch" placeholder="æœç´¢æ”¶è—..." class="search-input">
                    <select id="favoritesSort" class="sort-select">
                        <option value="date-desc">æŒ‰æ—¶é—´é™åº</option>
                        <option value="date-asc">æŒ‰æ—¶é—´å‡åº</option>
                        <option value="name-asc">æŒ‰åç§°å‡åº</option>
                        <option value="name-desc">æŒ‰åç§°é™åº</option>
                        <option value="source">æŒ‰æ¥æºåˆ†ç»„</option>
                    </select>
                    <select id="favoritesFilter" class="filter-select">
                        <option value="all">å…¨éƒ¨æ”¶è—</option>
                        <option value="with-details">æœ‰è¯¦æƒ…çš„</option>
                        <option value="without-details">æ— è¯¦æƒ…çš„</option>
                        <option value="recent">æœ€è¿‘æ·»åŠ </option>
                    </select>
                </div>
            </div>
            <div id="favorites" class="favorites-grid"></div>
        </section>

        <!-- ç«™ç‚¹å¯¼èˆª -->
        <section id="sitesSection" class="sites-section">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            <div class="loading-sites">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨åŠ è½½ç«™ç‚¹å¯¼èˆª...</p>
            </div>
        </section>
    </main>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal" aria-labelledby="login-title" role="dialog">
        <div class="modal-content">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="login-title">ç”¨æˆ·ç™»å½•</h2>
            <form id="loginForm" novalidate>
                <div class="form-group">
                    <input 
                        type="text" 
                        id="loginUsername" 
                        placeholder="ç”¨æˆ·åæˆ–é‚®ç®±" 
                        required 
                        autocomplete="username"
                        maxlength="50"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="loginPassword" 
                        placeholder="å¯†ç " 
                        required 
                        autocomplete="current-password"
                        maxlength="50"
                    >
                </div>
                <button type="submit" class="submit-btn">ç™»å½•</button>
                <div class="form-links">
                    <a href="#" id="showRegister">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ</a>
                </div>
            </form>
        </div>
    </div>

    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="registerModal" class="modal" aria-labelledby="register-title" role="dialog">
        <div class="modal-content">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="register-title">ç”¨æˆ·æ³¨å†Œ</h2>
            <form id="registerForm" novalidate>
                <div class="form-group">
                    <input 
                        type="text" 
                        id="regUsername" 
                        placeholder="ç”¨æˆ·å" 
                        required 
                        autocomplete="username"
                        maxlength="20"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="email" 
                        id="regEmail" 
                        placeholder="é‚®ç®±" 
                        required 
                        autocomplete="email"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="regPassword" 
                        placeholder="å¯†ç " 
                        required 
                        autocomplete="new-password"
                        maxlength="50"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="regConfirmPassword" 
                        placeholder="ç¡®è®¤å¯†ç " 
                        required 
                        autocomplete="new-password"
                        maxlength="50"
                    >
                </div>
                <button type="submit" class="submit-btn">æ³¨å†Œ</button>
                <div class="form-links">
                    <a href="#" id="showLogin">å·²æœ‰è´¦å·ï¼Ÿç™»å½•</a>
                </div>
            </form>
        </div>
    </div>

    <!-- è¯¦æƒ…æå–è®¾ç½®æ¨¡æ€æ¡†ï¼ˆå¢å¼ºç‰ˆï¼‰ -->
    <div id="detailSettingsModal" class="modal detail-settings-modal" aria-labelledby="detail-settings-title" role="dialog" style="display:none;">
        <div class="modal-content modal-large">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="detail-settings-title">ğŸ”‹ è¯¦æƒ…æå–è®¾ç½®</h2>
            
            <div class="settings-tabs">
                <button class="tab-btn active" data-tab="basic">åŸºç¡€è®¾ç½®</button>
                <button class="tab-btn" data-tab="advanced">é«˜çº§è®¾ç½®</button>
                <button class="tab-btn" data-tab="display">æ˜¾ç¤ºé€‰é¡¹</button>
                <button class="tab-btn" data-tab="performance">æ€§èƒ½ä¼˜åŒ–</button>
            </div>
            
            <form id="detailSettingsForm" novalidate>
                <!-- åŸºç¡€è®¾ç½® -->
                <div id="basicSettings" class="settings-panel active">
                    <h3>åŸºç¡€æå–è®¾ç½®</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoExtractDetails">
                            <span>è‡ªåŠ¨æå–è¯¦æƒ…ä¿¡æ¯</span>
                            <small>æœç´¢åè‡ªåŠ¨å¼€å§‹è¯¦æƒ…æå–</small>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="maxAutoExtractions">è‡ªåŠ¨æå–æ•°é‡ä¸Šé™:</label>
                        <input type="number" id="maxAutoExtractions" min="1" max="20" value="5">
                        <small>è‡ªåŠ¨æ¨¡å¼ä¸‹æœ€å¤šæå–å¤šå°‘ä¸ªç»“æœçš„è¯¦æƒ…</small>
                    </div>
                    <div class="form-group">
                        <label for="extractionBatchSize">æ‰¹é‡æå–å¤§å°:</label>
                        <input type="number" id="extractionBatchSize" min="1" max="20" value="3">
                        <small>æ¯æ‰¹æ¬¡åŒæ—¶å¤„ç†çš„æå–ä»»åŠ¡æ•°é‡</small>
                    </div>
                    <div class="form-group">
                        <label for="extractionTimeout">æå–è¶…æ—¶æ—¶é—´:</label>
                        <input type="number" id="extractionTimeout" min="5000" max="30000" step="1000" value="15000">
                        <small>å•ä¸ªè¯¦æƒ…æå–çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</small>
                    </div>
                </div>
                
                <!-- é«˜çº§è®¾ç½® -->
                <div id="advancedSettings" class="settings-panel">
                    <h3>é«˜çº§æå–è®¾ç½®</h3>
                    <div class="form-group">
                        <label for="maxConcurrentExtractions">æœ€å¤§å¹¶å‘æ•°:</label>
                        <input type="number" id="maxConcurrentExtractions" min="1" max="10" value="4">
                        <small>åŒæ—¶è¿›è¡Œçš„æœ€å¤§æå–ä»»åŠ¡æ•°</small>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableExtractionRetry">
                            <span>å¯ç”¨å¤±è´¥é‡è¯•</span>
                            <small>æå–å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•</small>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="maxExtractionRetries">æœ€å¤§é‡è¯•æ¬¡æ•°:</label>
                        <input type="number" id="maxExtractionRetries" min="0" max="5" value="2">
                    </div>
                    <div class="form-group">
                        <label for="extractionRetryDelay">é‡è¯•å»¶è¿Ÿ:</label>
                        <input type="number" id="extractionRetryDelay" min="500" max="5000" step="500" value="1000">
                        <small>é‡è¯•å‰çš„ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</small>
                    </div>
                    <div class="form-group">
                        <label for="cacheStrategy">ç¼“å­˜ç­–ç•¥:</label>
                        <select id="cacheStrategy">
                            <option value="aggressive">æ¿€è¿›ç¼“å­˜</option>
                            <option value="normal">æ­£å¸¸ç¼“å­˜</option>
                            <option value="conservative">ä¿å®ˆç¼“å­˜</option>
                            <option value="disabled">ç¦ç”¨ç¼“å­˜</option>
                        </select>
                    </div>
                </div>
                
                <!-- æ˜¾ç¤ºé€‰é¡¹ -->
                <div id="displaySettings" class="settings-panel">
                    <h3>å†…å®¹æ˜¾ç¤ºè®¾ç½®</h3>
                    <div class="form-group-grid">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showScreenshots">
                            <span>æ˜¾ç¤ºæˆªå›¾é¢„è§ˆ</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showDownloadLinks">
                            <span>æ˜¾ç¤ºä¸‹è½½é“¾æ¥</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showMagnetLinks">
                            <span>æ˜¾ç¤ºç£åŠ›é“¾æ¥</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showActressInfo">
                            <span>æ˜¾ç¤ºæ¼”å‘˜ä¿¡æ¯</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showMetadata">
                            <span>æ˜¾ç¤ºå…ƒæ•°æ®</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showTags">
                            <span>æ˜¾ç¤ºæ ‡ç­¾</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableImagePreview">
                            <span>å¯ç”¨å›¾ç‰‡é¢„è§ˆ</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="compactMode">
                            <span>ç´§å‡‘æ¨¡å¼</span>
                        </label>
                    </div>
                </div>
                
                <!-- æ€§èƒ½ä¼˜åŒ– -->
                <div id="performanceSettings" class="settings-panel">
                    <h3>æ€§èƒ½ä¸è¿‡æ»¤è®¾ç½®</h3>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableContentFilter">
                            <span>å¯ç”¨å†…å®¹è¿‡æ»¤</span>
                            <small>æ ¹æ®å…³é”®è¯è¿‡æ»¤ä¸é€‚å®œçš„å†…å®¹</small>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="contentFilterKeywords">è¿‡æ»¤å…³é”®è¯:</label>
                        <textarea id="contentFilterKeywords" placeholder="è¾“å…¥è¿‡æ»¤å…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableImageOptimization">
                            <span>å¯ç”¨å›¾ç‰‡ä¼˜åŒ–</span>
                            <small>è‡ªåŠ¨ä¼˜åŒ–å›¾ç‰‡åŠ è½½å’Œæ˜¾ç¤º</small>
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="preferredImageQuality">å›¾ç‰‡è´¨é‡åå¥½:</label>
                        <select id="preferredImageQuality">
                            <option value="high">é«˜è´¨é‡</option>
                            <option value="medium">ä¸­ç­‰è´¨é‡</option>
                            <option value="low">ä½è´¨é‡ï¼ˆèŠ‚çœæµé‡ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showExtractionProgress">
                            <span>æ˜¾ç¤ºæå–è¿›åº¦</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showExtractionStats">
                            <span>æ˜¾ç¤ºæå–ç»Ÿè®¡</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="submit-btn">ä¿å­˜è®¾ç½®</button>
                    <button type="button" class="cancel-btn" onclick="document.getElementById('detailSettingsModal').style.display='none'">å–æ¶ˆ</button>
                    <button type="button" class="reset-btn" onclick="resetDetailSettings()">é‡ç½®ä¸ºé»˜è®¤</button>
                    <button type="button" class="test-btn" onclick="testDetailExtraction()">æµ‹è¯•æå–</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è¯¦æƒ…æå–å†å²æ¨¡æ€æ¡†ï¼ˆæ–°å¢ï¼‰ -->
    <div id="extractionHistoryModal" class="modal" aria-labelledby="extraction-history-title" role="dialog" style="display:none;">
        <div class="modal-content modal-large">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="extraction-history-title">ğŸ“Š è¯¦æƒ…æå–å†å²</h2>
            
            <div class="history-controls">
                <input type="text" id="historySearch" placeholder="æœç´¢å†å²è®°å½•..." class="search-input">
                <select id="historyFilter" class="filter-select">
                    <option value="all">å…¨éƒ¨è®°å½•</option>
                    <option value="success">æˆåŠŸ</option>
                    <option value="failed">å¤±è´¥</option>
                    <option value="recent">æœ€è¿‘7å¤©</option>
                </select>
                <button id="clearHistoryBtn" class="action-btn">æ¸…ç©ºå†å²</button>
                <button id="exportHistoryBtn" class="action-btn">å¯¼å‡ºå†å²</button>
            </div>
            
            <div id="extractionHistoryList" class="extraction-history-list">
                <!-- å†å²è®°å½•å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- Toasté€šçŸ¥ -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;" aria-label="åŠ è½½ä¸­">
        <div class="spinner"></div>
        <div class="loading-text">æ­£åœ¨å¤„ç†è¯·æ±‚...</div>
    </div>

    <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="connectionStatus" class="connection-status" style="display:none;">
        <span class="status-indicator"></span>
        <span class="status-text">æ£€æŸ¥è¿æ¥...</span>
    </div>

    <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="imagePreviewContainer"></div>

    <!-- è¯¦æƒ…æå–å¸®åŠ©æç¤ºï¼ˆæ–°å¢ï¼‰ -->
    <div id="extractionHelpTooltip" class="extraction-help-tooltip" style="display:none;">
        <div class="tooltip-content">
            <h4>è¯¦æƒ…æå–åŠŸèƒ½è¯´æ˜</h4>
            <ul>
                <li>ğŸ”‹ æ ‡è¯†çš„ç«™ç‚¹æ”¯æŒè¯¦æƒ…æå–</li>
                <li>è‡ªåŠ¨æ¨¡å¼ï¼šæœç´¢åç«‹å³å¼€å§‹æå–</li>
                <li>æ‰‹åŠ¨æ¨¡å¼ï¼šç‚¹å‡»"è¯¦æƒ…"æŒ‰é’®å•ç‹¬æå–</li>
                <li>æ‰¹é‡æ¨¡å¼ï¼šä¸€æ¬¡æ€§æå–å¤šä¸ªç»“æœ</li>
                <li>æ™ºèƒ½æ¨¡å¼ï¼šæ ¹æ®è´¨é‡è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç»“æœ</li>
            </ul>
            <button class="tooltip-close" onclick="this.parentElement.parentElement.style.display='none'">çŸ¥é“äº†</button>
        </div>
    </div>

    <!-- ä¸»è¦è„šæœ¬åŠ è½½ -->
    <script type="module">
        // ğŸ”„ é‡è¦ï¼šç°åœ¨ä½¿ç”¨æ›´æ–°åçš„æœåŠ¡æ¶æ„åˆå§‹åŒ–åº”ç”¨
        import MagnetSearchApp from './src/pages/main/main.js';
        
        // å…¨å±€å¯¼èˆªå‡½æ•°ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
        window.navigateToDashboard = function() {
            if (window.app && window.app.navigateToDashboard) {
                window.app.navigateToDashboard();
            }
        };

        // å…¨å±€è¯¦æƒ…æå–åŠŸèƒ½æ§åˆ¶å‡½æ•°
        window.toggleDetailExtraction = function() {
            if (window.app && window.app.toggleDetailExtraction) {
                window.app.toggleDetailExtraction();
            }
        };

        window.openDetailSettings = function() {
            const modal = document.getElementById('detailSettingsModal');
            if (modal) {
                modal.style.display = 'block';
            }
        };

        // é‡ç½®è¯¦æƒ…è®¾ç½®ä¸ºé»˜è®¤å€¼
        window.resetDetailSettings = function() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è¯¦æƒ…æå–è®¾ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿ')) {
                // é‡ç½®è¡¨å•å­—æ®µä¸ºé»˜è®¤å€¼
                document.getElementById('autoExtractDetails').checked = true;
                document.getElementById('maxAutoExtractions').value = 5;
                document.getElementById('extractionBatchSize').value = 3;
                document.getElementById('extractionTimeout').value = 15000;
                document.getElementById('maxConcurrentExtractions').value = 4;
                document.getElementById('enableExtractionRetry').checked = true;
                document.getElementById('maxExtractionRetries').value = 2;
                document.getElementById('extractionRetryDelay').value = 1000;
                document.getElementById('cacheStrategy').value = 'normal';
                document.getElementById('showScreenshots').checked = true;
                document.getElementById('showDownloadLinks').checked = true;
                document.getElementById('showMagnetLinks').checked = true;
                document.getElementById('showActressInfo').checked = true;
                document.getElementById('showMetadata').checked = true;
                document.getElementById('showTags').checked = true;
                document.getElementById('enableImagePreview').checked = true;
                document.getElementById('compactMode').checked = false;
                document.getElementById('enableContentFilter').checked = false;
                document.getElementById('contentFilterKeywords').value = '';
                document.getElementById('enableImageOptimization').checked = true;
                document.getElementById('preferredImageQuality').value = 'high';
                document.getElementById('showExtractionProgress').checked = true;
                document.getElementById('showExtractionStats').checked = true;
                
                showToast('è®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'success');
            }
        };

        // æµ‹è¯•è¯¦æƒ…æå–åŠŸèƒ½
        window.testDetailExtraction = async function() {
            if (!window.app || !window.app.currentUser) {
                showToast('è¯·å…ˆç™»å½•åå†è¿›è¡Œæµ‹è¯•', 'error');
                return;
            }

            try {
                showLoading(true);
                showToast('æ­£åœ¨æµ‹è¯•è¯¦æƒ…æå–åŠŸèƒ½...', 'info');
                
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æµ‹è¯•é€»è¾‘
                await new Promise(resolve => setTimeout(resolve, 2000)); // æ¨¡æ‹Ÿæµ‹è¯•
                
                showToast('è¯¦æƒ…æå–åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼', 'success');
            } catch (error) {
                console.error('æµ‹è¯•è¯¦æƒ…æå–åŠŸèƒ½å¤±è´¥:', error);
                showToast('æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        };

        // ğŸ”„ æ‰¹é‡æå–è¯¦æƒ… - ä½¿ç”¨ç»Ÿä¸€æœç´¢ç®¡ç†å™¨
        window.batchExtractDetails = function() {
            if (window.unifiedSearchManager && window.unifiedSearchManager.extractBatchDetails) {
                window.unifiedSearchManager.extractBatchDetails();
            }
        };

        // æ™ºèƒ½æå–è¯¦æƒ…ï¼ˆæ–°å¢ï¼‰
        window.smartExtractDetails = function() {
            if (window.unifiedSearchManager && window.unifiedSearchManager.smartExtractDetails) {
                window.unifiedSearchManager.smartExtractDetails();
            }
        };

        // å–æ¶ˆè¯¦æƒ…æå–ï¼ˆæ–°å¢ï¼‰
        window.cancelExtraction = function() {
            if (window.unifiedSearchManager && window.unifiedSearchManager.cancelExtraction) {
                window.unifiedSearchManager.cancelExtraction();
            }
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–åº”ç”¨...');

            try {
                // æ›´æ–°é¡µé¢æ ‡é¢˜ä¸å“ç‰Œåç§°
                if (window.API_CONFIG) {
                    const appName = window.API_CONFIG.APP_NAME || 'ç£åŠ›å¿«æœ';
                    document.getElementById('page-title').textContent = `${appName} - ä¸“ä¸šç‰ˆ`;
                    document.getElementById('brand-text').textContent = appName;
                    document.getElementById('hero-title').textContent = `${appName} - ä¸“ä¸šç‰ˆ`;
                }
                
                // ğŸ”„ æ ¸å¿ƒå˜æ›´ï¼šåˆ›å»ºä½¿ç”¨ç»Ÿä¸€æœç´¢ç»„ä»¶çš„åº”ç”¨å®ä¾‹
                window.app = new MagnetSearchApp();
                
                // åˆå§‹åŒ–è¯¦æƒ…æå–åŠŸèƒ½ç›¸å…³çš„äº‹ä»¶ç›‘å¬å™¨
                initDetailExtractionUI();
                
                // åˆå§‹åŒ–é«˜çº§æœç´¢é€‰é¡¹
                initAdvancedSearchOptions();
                
                // åˆå§‹åŒ–è®¾ç½®é¢æ¿
                initDetailSettingsPanel();
                
                console.log('âœ… åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
                const errorDiv = document.createElement('div');
                errorDiv.className = 'init-error';
                errorDiv.innerHTML = `
                    <div style="background: #fee; border: 1px solid #f00; padding: 1rem; margin: 1rem; border-radius: 4px;">
                        <h3>âš ï¸ åº”ç”¨åˆå§‹åŒ–å¤±è´¥</h3>
                        <p>é”™è¯¯ä¿¡æ¯ï¼š${error.message}</p>
                        <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼Œæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚</p>
                        <button onclick="window.location.reload()" style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            åˆ·æ–°é¡µé¢
                        </button>
                    </div>
                `;
                document.body.insertBefore(errorDiv, document.body.firstChild);
            }
        });

        // åˆå§‹åŒ–è¯¦æƒ…æå–åŠŸèƒ½UI
        function initDetailExtractionUI() {
            // è¯¦æƒ…æå–åˆ‡æ¢æŒ‰é’®
            const detailToggleBtn = document.getElementById('detailExtractionToggle');
            if (detailToggleBtn) {
                detailToggleBtn.addEventListener('click', window.toggleDetailExtraction);
            }

            // æ‰¹é‡æå–æŒ‰é’®
            const batchExtractBtn = document.getElementById('batchExtractBtn');
            if (batchExtractBtn) {
                batchExtractBtn.addEventListener('click', window.batchExtractDetails);
            }

            // æ™ºèƒ½æå–æŒ‰é’®
            const smartExtractBtn = document.getElementById('smartExtractBtn');
            if (smartExtractBtn) {
                smartExtractBtn.addEventListener('click', window.smartExtractDetails);
            }

            // å–æ¶ˆæå–æŒ‰é’®
            const cancelExtractionBtn = document.getElementById('cancelExtractionBtn');
            if (cancelExtractionBtn) {
                cancelExtractionBtn.addEventListener('click', window.cancelExtraction);
            }

            // è¯¦æƒ…è®¾ç½®è¡¨å•
            const detailSettingsForm = document.getElementById('detailSettingsForm');
            if (detailSettingsForm) {
                detailSettingsForm.addEventListener('submit', handleDetailSettingsSubmit);
            }

            // æœç´¢é€‰é¡¹å¤é€‰æ¡†
            const enableDetailCheckbox = document.getElementById('enableDetailExtraction');
            const enableStatusCheckbox = document.getElementById('enableSourceStatus');
            const enableFilterCheckbox = document.getElementById('enableContentFilter');
            
            if (enableDetailCheckbox) {
                enableDetailCheckbox.addEventListener('change', handleDetailExtractionToggle);
            }
            
            if (enableStatusCheckbox) {
                enableStatusCheckbox.addEventListener('change', handleSourceStatusToggle);
            }
            
            if (enableFilterCheckbox) {
                enableFilterCheckbox.addEventListener('change', handleContentFilterToggle);
            }
        }

        // åˆå§‹åŒ–é«˜çº§æœç´¢é€‰é¡¹
        function initAdvancedSearchOptions() {
            const toggleBtn = document.getElementById('toggleSearchOptions');
            const optionsPanel = document.querySelector('.search-options');
            
            if (toggleBtn && optionsPanel) {
                toggleBtn.addEventListener('click', () => {
                    const isVisible = optionsPanel.style.display !== 'none';
                    optionsPanel.style.display = isVisible ? 'none' : 'block';
                    
                    const btnText = toggleBtn.querySelector('.btn-text');
                    const btnIcon = toggleBtn.querySelector('.btn-icon');
                    
                    if (btnText) {
                        btnText.textContent = isVisible ? 'é«˜çº§é€‰é¡¹' : 'éšè—é€‰é¡¹';
                    }
                    
                    if (btnIcon) {
                        btnIcon.textContent = isVisible ? 'âš™ï¸' : 'ğŸ”¼';
                    }
                });
            }
        }

        // åˆå§‹åŒ–è®¾ç½®é¢æ¿
        function initDetailSettingsPanel() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const settingsPanels = document.querySelectorAll('.settings-panel');
            
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
                    tabButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // æ›´æ–°é¢æ¿æ˜¾ç¤ºçŠ¶æ€
                    settingsPanels.forEach(panel => {
                        panel.classList.remove('active');
                        if (panel.id === targetTab + 'Settings') {
                            panel.classList.add('active');
                        }
                    });
                });
            });
        }

        // å¤„ç†è¯¦æƒ…è®¾ç½®è¡¨å•æäº¤
        async function handleDetailSettingsSubmit(event) {
            event.preventDefault();
            
            if (!window.app || !window.app.currentUser) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                const settings = {
                    autoExtractDetails: document.getElementById('autoExtractDetails').checked,
                    maxAutoExtractions: parseInt(document.getElementById('maxAutoExtractions').value),
                    extractionBatchSize: parseInt(document.getElementById('extractionBatchSize').value),
                    extractionTimeout: parseInt(document.getElementById('extractionTimeout').value),
                    maxConcurrentExtractions: parseInt(document.getElementById('maxConcurrentExtractions').value),
                    enableExtractionRetry: document.getElementById('enableExtractionRetry').checked,
                    maxExtractionRetries: parseInt(document.getElementById('maxExtractionRetries').value),
                    extractionRetryDelay: parseInt(document.getElementById('extractionRetryDelay').value),
                    cacheStrategy: document.getElementById('cacheStrategy').value,
                    showScreenshots: document.getElementById('showScreenshots').checked,
                    showDownloadLinks: document.getElementById('showDownloadLinks').checked,
                    showMagnetLinks: document.getElementById('showMagnetLinks').checked,
                    showActressInfo: document.getElementById('showActressInfo').checked,
                    showMetadata: document.getElementById('showMetadata').checked,
                    showTags: document.getElementById('showTags').checked,
                    enableImagePreview: document.getElementById('enableImagePreview').checked,
                    compactMode: document.getElementById('compactMode').checked,
                    enableContentFilter: document.getElementById('enableContentFilter').checked,
                    contentFilterKeywords: document.getElementById('contentFilterKeywords').value.split(',').map(k => k.trim()).filter(k => k),
                    enableImageOptimization: document.getElementById('enableImageOptimization').checked,
                    preferredImageQuality: document.getElementById('preferredImageQuality').value,
                    showExtractionProgress: document.getElementById('showExtractionProgress').checked,
                    showExtractionStats: document.getElementById('showExtractionStats').checked
                };

                // ä¿å­˜è®¾ç½®åˆ°åç«¯
                const currentSettings = await apiService.getUserSettings();
                await apiService.updateUserSettings({
                    ...currentSettings,
                    ...settings
                });

                // å…³é—­æ¨¡æ€æ¡†
                document.getElementById('detailSettingsModal').style.display = 'none';
                
                // ğŸ”„ é€šçŸ¥ç»Ÿä¸€æœç´¢ç®¡ç†å™¨é‡æ–°åŠ è½½é…ç½®
                if (window.unifiedSearchManager && window.unifiedSearchManager.loadUserConfig) {
                    await window.unifiedSearchManager.loadUserConfig();
                }

                showToast('è¯¦æƒ…æå–è®¾ç½®å·²ä¿å­˜', 'success');
                
                // è§¦å‘é…ç½®å˜æ›´äº‹ä»¶
                window.dispatchEvent(new CustomEvent('detailExtractionConfigChanged', {
                    detail: { settings }
                }));

            } catch (error) {
                console.error('ä¿å­˜è¯¦æƒ…æå–è®¾ç½®å¤±è´¥:', error);
                showToast('ä¿å­˜è®¾ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤„ç†è¯¦æƒ…æå–å¼€å…³
        async function handleDetailExtractionToggle(event) {
            if (!window.app || !window.app.currentUser) {
                event.target.checked = false;
                showToast('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                const enabled = event.target.checked;
                const currentSettings = await apiService.getUserSettings();
                await apiService.updateUserSettings({
                    ...currentSettings,
                    enableDetailExtraction: enabled
                });

                showToast(`è¯¦æƒ…æå–åŠŸèƒ½å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
            } catch (error) {
                console.error('åˆ‡æ¢è¯¦æƒ…æå–åŠŸèƒ½å¤±è´¥:', error);
                event.target.checked = !event.target.checked;
                showToast('è®¾ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤„ç†æºçŠ¶æ€æ£€æŸ¥å¼€å…³
        async function handleSourceStatusToggle(event) {
            if (!window.app || !window.app.currentUser) {
                event.target.checked = false;
                showToast('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                const enabled = event.target.checked;
                const currentSettings = await apiService.getUserSettings();
                await apiService.updateUserSettings({
                    ...currentSettings,
                    checkSourceStatus: enabled
                });

                showToast(`æºçŠ¶æ€æ£€æŸ¥å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
            } catch (error) {
                console.error('åˆ‡æ¢æºçŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
                event.target.checked = !event.target.checked;
                showToast('è®¾ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤„ç†å†…å®¹è¿‡æ»¤å¼€å…³
        async function handleContentFilterToggle(event) {
            if (!window.app || !window.app.currentUser) {
                event.target.checked = false;
                showToast('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                const enabled = event.target.checked;
                const currentSettings = await apiService.getUserSettings();
                await apiService.updateUserSettings({
                    ...currentSettings,
                    enableContentFilter: enabled
                });

                showToast(`å†…å®¹è¿‡æ»¤å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
            } catch (error) {
                console.error('åˆ‡æ¢å†…å®¹è¿‡æ»¤å¤±è´¥:', error);
                event.target.checked = !event.target.checked;
                showToast('è®¾ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && window.app) {
                setTimeout(() => {
                    if (window.app.isInitialized) {
                        window.app.checkConnectionStatus();
                    }
                }, 100);
            }
        });

        // ğŸ”„ æœåŠ¡æ¶æ„å¥åº·æ£€æŸ¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    if (window.servicesManager) {
                        window.servicesManager.performHealthCheck().then(status => {
                            console.log('ğŸ¥ æœåŠ¡å¥åº·æ£€æŸ¥ç»“æœ:', status);
                        }).catch(console.error);
                    }
                }, 2000);
            });
        }
    </script>
</body>
</html>