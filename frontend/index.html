<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">ç£åŠ›å¿«æœ - ä¸“ä¸šç‰ˆ</title>
    <meta name="description" content="ä¸“ä¸šçš„ç£åŠ›æœç´¢å·¥å…·ï¼Œæ”¯æŒäº‘ç«¯åŒæ­¥ï¼Œæ™ºèƒ½æœç´¢ï¼Œè¯¦æƒ…æå–">
	
    <!-- æ ¸å¿ƒæ ·å¼ - å¿…é¡»æœ€å…ˆå¼•å…¥ -->
    <link rel="stylesheet" href="css/core/variables.css">
    <link rel="stylesheet" href="css/core/base.css">
    
    <!-- ç»„ä»¶æ ·å¼ - æŒ‰ä¾èµ–é¡ºåºå¼•å…¥ -->
    <link rel="stylesheet" href="css/components/navbar.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/toast.css">
    <link rel="stylesheet" href="css/components/loading.css">
    <link rel="stylesheet" href="css/components/search.css">
	<link rel="stylesheet" href="css/components/detail-card.css">
    <!-- ğŸ†• é‚®ç®±éªŒè¯æ ·å¼ -->
    <link rel="stylesheet" href="css/components/email-verification.css">
    <!-- æœç´¢é…ç½®ç®¡ç†æ ·å¼ -->
    <link rel="stylesheet" href="css/components/search-config.css">
    <link rel="stylesheet" href="css/components/status.css">
    <link rel="stylesheet" href="css/components/search-status.css">
    
    <!-- ä¸»é¡µä¸“ç”¨æ ·å¼ -->
    <link rel="stylesheet" href="css/pages/main.css">
    
    <!-- å·¥å…·æ ·å¼ - æœ€åå¼•å…¥ -->
    <link rel="stylesheet" href="css/utils/animations.css">
    <link rel="stylesheet" href="css/utils/responsive.css">
    <link rel="stylesheet" href="css/utils/accessibility.css">
    <link rel="stylesheet" href="css/utils/print.css">
	
	<!-- ä»£ç†åŠŸèƒ½UIæ ·å¼ -->
    <link rel="stylesheet" href="css/components/proxy-ui.css">
	
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    
    <!-- æœç´¢ä¸è¯¦æƒ…æå–é…ç½®æ”¯æŒçš„metaæ ‡ç­¾ -->
    <meta name="search-config-management-supported" content="true">
    <meta name="unified-search-architecture" content="true">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="./index.html">
                    <img src="images/logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
                    <span class="brand-text" id="brand-text">ç£åŠ›å¿«æœ</span>
                </a>
            </div>
            <div class="nav-menu">
                <button id="themeToggle" class="theme-btn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
                <!-- é…ç½®ç®¡ç†æŒ‰é’® -->
                <button id="configManagementBtn" class="config-management-btn" title="æœç´¢ä¸è¯¦æƒ…æå–é…ç½®" style="display:none;">
                    âš™ï¸
                </button>
                <!-- è¯¦æƒ…æå–æœåŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                <div id="detailServiceStatus" class="service-status" title="è¯¦æƒ…æå–æœåŠ¡çŠ¶æ€" style="display:none;">
                    <span class="status-icon">âš ï¸</span>
                    <span class="status-text">è¯¦æƒ…æå–: æ£€æŸ¥ä¸­</span>
                </div>
                <div id="userMenu" class="user-menu">
                    <button id="loginBtn" class="login-btn">ç™»å½•</button>
                    <div id="userInfo" class="user-info" style="display:none;">
                        <span id="username" class="username"></span>
                        <div class="dropdown">
                            <button class="dropdown-btn" title="ç”¨æˆ·èœå•">â–¼</button>
                            <div class="dropdown-content">
                                <a href="#" onclick="navigateToDashboard(); return false;">ä¸ªäººä¸­å¿ƒ</a>
                                <!-- é…ç½®ç®¡ç†å…¥å£ -->
                                <a href="#" onclick="window.openConfigManagement && window.openConfigManagement(); return false;">é…ç½®ç®¡ç†</a>
                                <a href="#" id="logoutBtn">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content" style="display:none;">
        <!-- HeroåŒºåŸŸ -->
        <section class="hero">
            <h1 class="hero-title" id="hero-title">ç£åŠ›å¿«æœ - ä¸“ä¸šç‰ˆ</h1>
            <p class="hero-subtitle">æ™ºèƒ½æœç´¢ï¼Œäº‘ç«¯åŒæ­¥ï¼Œæè‡´ä½“éªŒ | å®Œå–„çš„è¯¦æƒ…æå–æœåŠ¡æ”¯æŒ</p>
            
            <!-- æœç´¢æ¡† -->
            <div class="search-container">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input" 
                        placeholder="è¯·è¾“å…¥ç•ªå·æˆ–å…³é”®è¯" 
                        autocomplete="off"
                        maxlength="100"
                    >
                    <button id="searchBtn" class="search-btn" title="æœç´¢">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                        </svg>
                        <span>æœç´¢</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- å¿«é€Ÿæç¤º -->
        <section id="quickTips" class="quick-tips" style="display:none;">
            <div class="tips-content">
                <h3>ğŸ’¡ æœç´¢æŠ€å·§</h3>
                <ul>
                    <li>è¾“å…¥å®Œæ•´ç•ªå·è·å¾—æœ€ç²¾ç¡®ç»“æœ</li>
                    <li>ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¤šä¸ªå…³é”®è¯</li>
                    <li>ç™»å½•åå¯äº«å—äº‘ç«¯åŒæ­¥æœåŠ¡</li>
                    <li>æ”¯æŒè¯¦æƒ…æå–çš„ç«™ç‚¹ä¼šæ˜¾ç¤º ğŸ”‹ æ ‡è¯†</li>
                    <li>è¯¦æƒ…æå–åŒ…å«é«˜æ¸…å°å›¾ã€æ¼”å‘˜ä¿¡æ¯ã€ä¸‹è½½é“¾æ¥ç­‰</li>
                    <li>åœ¨é…ç½®ç®¡ç†ä¸­å¯è‡ªå®šä¹‰æœç´¢å’Œæå–é€‰é¡¹</li>
                </ul>
            </div>
        </section>

        <!-- æœç´¢é…ç½®ç®¡ç†åŒºåŸŸ -->
        <section id="searchConfigSection" class="search-config-section" style="display:none;">
            <div class="section-header">
                <h2>âš™ï¸ æœç´¢ä¸è¯¦æƒ…æå–é…ç½®</h2>
                <div class="section-actions">
                    <button id="showConfigBtn" class="config-btn" title="æ˜¾ç¤ºé…ç½®ç®¡ç†ç•Œé¢">
                        <span class="btn-icon">âš™ï¸</span>
                        <span class="btn-text">é…ç½®ç®¡ç†</span>
                    </button>
                    <button id="hideConfigBtn" class="config-btn" style="display:none;" title="éšè—é…ç½®ç®¡ç†ç•Œé¢">
                        <span class="btn-icon">ğŸ”½</span>
                        <span class="btn-text">æ”¶èµ·é…ç½®</span>
                    </button>
                </div>
            </div>
            <!-- é…ç½®ç®¡ç†UIå®¹å™¨ - ç”±SearchConfigManageråŠ¨æ€æ¸²æŸ“ -->
            <div id="searchConfigContainer" class="search-config-container" style="display:none;">
                <!-- å†…å®¹å°†é€šè¿‡SearchConfigManagerçš„initConfigUIæ–¹æ³•åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>

        <!-- æœç´¢çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <section id="searchStatusIndicator" class="search-status-indicator" style="display:none;">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° -->
        </section>

        <!-- è¯¦æƒ…æå–è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <section id="extractionProgress" class="extraction-progress-container" style="display:none;">
            <div class="progress-header">
                <span class="progress-title">æ­£åœ¨æå–è¯¦æƒ…ä¿¡æ¯</span>
                <span class="progress-stats">0 / 0</span>
                <button class="progress-close" onclick="this.closest('.extraction-progress-container').style.display='none'">Ã—</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-message">æ­£åœ¨å¤„ç†æœç´¢ç»“æœ...</div>
            <div class="progress-details">
                <small>å¹³å‡ç”¨æ—¶: <span class="avg-time">è®¡ç®—ä¸­...</span> | æˆåŠŸç‡: <span class="success-rate">è®¡ç®—ä¸­...</span></small>
            </div>
        </section>

        <!-- è¯¦æƒ…æå–æ´å¯Ÿä¿¡æ¯ -->
        <section id="extractionInsights" class="extraction-insights-container" style="display:none;">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° -->
        </section>

        <!-- æœç´¢å†å² -->
        <section id="historySection" class="history-section" style="display:none;">
            <div class="section-header">
                <h2>ğŸ•’ æœç´¢å†å²</h2>
                <button id="clearHistoryBtn" class="clear-btn">æ¸…ç©ºå†å²</button>
            </div>
            <div id="historyList" class="history-list"></div>
        </section>

        <!-- æœç´¢ç»“æœ -->
        <section id="resultsSection" class="results-section" style="display:none;">
            <div class="section-header">
                <h2>ğŸ” æœç´¢ç»“æœ</h2>
                <div class="section-actions">
                    <!-- è¯¦æƒ…æå–æ§åˆ¶æŒ‰é’® -->
                    <button id="batchExtractBtn" class="action-btn detail-action-btn" style="display:none;" title="æ‰¹é‡æå–å½“å‰æœç´¢ç»“æœçš„è¯¦æƒ…ä¿¡æ¯">
                        <span class="btn-icon">ğŸ”‹</span>
                        <span class="btn-text">æ‰¹é‡æå–</span>
                    </button>
                    <button id="refreshStatsBtn" class="action-btn stats-btn" style="display:none;" title="åˆ·æ–°è¯¦æƒ…æå–ç»Ÿè®¡">
                        <span class="btn-icon">ğŸ“Š</span>
                        <span class="btn-text">åˆ·æ–°ç»Ÿè®¡</span>
                    </button>
                    <button id="exportResultsBtn" class="action-btn" style="display:none;">å¯¼å‡ºç»“æœ</button>
                    <button id="clearResultsBtn" class="clear-btn">æ¸…ç©ºç»“æœ</button>
                </div>
            </div>
            <div id="searchInfo" class="search-info"></div>
            
            <!-- è¯¦æƒ…æå–ç»Ÿè®¡ä¿¡æ¯ -->
            <div id="extractionStats" class="detail-extraction-stats" style="display:none;">
                <div class="stats-content">
                    <span class="stats-item">
                        <span class="stats-label">æ”¯æŒè¯¦æƒ…æå–:</span>
                        <span class="stats-value" id="supportedCount">0</span>
                    </span>
                    <span class="stats-item">
                        <span class="stats-label">å·²æå–:</span>
                        <span class="stats-value" id="extractedCount">0</span>
                    </span>
                    <span class="stats-item">
                        <span class="stats-label">æå–æˆåŠŸç‡:</span>
                        <span class="stats-value" id="successRate">0%</span>
                    </span>
                    <span class="stats-item">
                        <span class="stats-label">ç¼“å­˜å‘½ä¸­:</span>
                        <span class="stats-value" id="cacheHitRate">0%</span>
                    </span>
                </div>
            </div>
            
            <div id="results" class="results-grid"></div>
        </section>

        <!-- æ”¶è—å¤¹ -->
        <section class="favorites-section">
            <div class="section-header">
                <h2>â­ æˆ‘çš„æ”¶è—</h2>
                <div class="section-actions">
                    <button id="syncFavoritesBtn" class="sync-btn" style="display:none;">åŒæ­¥æ”¶è—</button>
                    <button id="importFavoritesBtn" class="action-btn" style="display:none;">å¯¼å…¥æ”¶è—</button>
                    <button id="exportFavoritesBtn" class="action-btn" style="display:none;">å¯¼å‡ºæ”¶è—</button>
                </div>
            </div>
            <div class="favorites-controls" style="display:none;">
                <input type="text" id="favoritesSearch" placeholder="æœç´¢æ”¶è—..." class="search-input">
                <select id="favoritesSort" class="sort-select">
                    <option value="date-desc">æŒ‰æ—¶é—´é™åº</option>
                    <option value="date-asc">æŒ‰æ—¶é—´å‡åº</option>
                    <option value="name-asc">æŒ‰åç§°å‡åº</option>
                    <option value="name-desc">æŒ‰åç§°é™åº</option>
                </select>
            </div>
            <div id="favorites" class="favorites-grid"></div>
        </section>

        <!-- ç«™ç‚¹å¯¼èˆª -->
        <section id="sitesSection" class="sites-section">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            <div class="loading-sites">
                <p>æ­£åœ¨åŠ è½½ç«™ç‚¹å¯¼èˆª...</p>
            </div>
        </section>
    </main>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal" aria-labelledby="login-title" role="dialog">
        <div class="modal-content">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="login-title">ç”¨æˆ·ç™»å½•</h2>
            <form id="loginForm" novalidate>
                <div class="form-group">
                    <input 
                        type="text" 
                        id="loginUsername" 
                        placeholder="ç”¨æˆ·åæˆ–é‚®ç®±" 
                        required 
                        autocomplete="username"
                        maxlength="50"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="loginPassword" 
                        placeholder="å¯†ç " 
                        required 
                        autocomplete="current-password"
                        maxlength="50"
                    >
                </div>
                <button type="submit" class="submit-btn">ç™»å½•</button>
                <div class="form-links">
                    <a href="#" id="showRegister">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ</a>
                    <!-- ğŸ†• æ›´æ–°å¿˜è®°å¯†ç é“¾æ¥ -->
                    <a href="#" id="showForgotPassword">å¿˜è®°å¯†ç ï¼Ÿ</a>
                </div>
            </form>
        </div>
    </div>

    <!-- ğŸ†• æ›´æ–°æ³¨å†Œæ¨¡æ€æ¡† - é›†æˆé‚®ç®±éªŒè¯ -->
    <div id="registerModal" class="modal" aria-labelledby="register-title" role="dialog">
        <div class="modal-content">
            <span class="close" aria-label="å…³é—­">&times;</span>
            <h2 id="register-title">ç”¨æˆ·æ³¨å†Œ</h2>
            <form id="registerForm" novalidate>
                <div class="form-group">
                    <input 
                        type="text" 
                        id="regUsername" 
                        placeholder="ç”¨æˆ·å" 
                        required 
                        autocomplete="username"
                        maxlength="20"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="email" 
                        id="regEmail" 
                        placeholder="é‚®ç®±" 
                        required 
                        autocomplete="email"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="regPassword" 
                        placeholder="å¯†ç " 
                        required 
                        autocomplete="new-password"
                        maxlength="50"
                    >
                </div>
                <div class="form-group">
                    <input 
                        type="password" 
                        id="regConfirmPassword" 
                        placeholder="ç¡®è®¤å¯†ç " 
                        required 
                        autocomplete="new-password"
                        maxlength="50"
                    >
                </div>
                <button type="submit" class="submit-btn">æ³¨å†Œå¹¶éªŒè¯é‚®ç®±</button>
                <div class="form-links">
                    <a href="#" id="showLogin">å·²æœ‰è´¦å·ï¼Ÿç™»å½•</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Toasté€šçŸ¥ -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Loading -->
    <div id="loading" class="loading" style="display:none;" aria-label="åŠ è½½ä¸­">
        <div class="spinner"></div>
    </div>

    <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="connectionStatus" class="connection-status" style="display:none;">
        <span class="status-indicator"></span>
        <span class="status-text">æ£€æŸ¥è¿æ¥...</span>
    </div>

    <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="imagePreviewContainer"></div>

    <!-- ä½¿ç”¨ç»Ÿä¸€æœç´¢ç»„ä»¶çš„è„šæœ¬åŠ è½½ -->
    <script type="module">
        // ç°åœ¨ä½¿ç”¨æ›´æ–°åçš„æœåŠ¡æ¶æ„åˆå§‹åŒ–åº”ç”¨
        import MagnetSearchApp from './src/pages/main/main.js';
        // ğŸ†• å¯¼å…¥é‚®ç®±éªŒè¯UIç»„ä»¶
        import { emailVerificationUI } from './src/components/email-verification-ui.js';
        
        // å…¨å±€å¯¼èˆªå‡½æ•°ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
        window.navigateToDashboard = function() {
            if (window.app && window.app.navigateToDashboard) {
                window.app.navigateToDashboard();
            }
        };

        // é…ç½®ç®¡ç†åŠŸèƒ½
        window.openConfigManagement = function() {
            const configSection = document.getElementById('searchConfigSection');
            const configContainer = document.getElementById('searchConfigContainer');
            
            if (configSection && configContainer) {
                configSection.style.display = 'block';
                configContainer.style.display = 'block';
                
                // åˆå§‹åŒ–é…ç½®UIï¼ˆå¦‚æœè¿˜æœªåˆå§‹åŒ–ï¼‰
                if (window.unifiedSearchManager && window.unifiedSearchManager.configManager) {
                    window.unifiedSearchManager.configManager.initConfigUI('searchConfigContainer');
                }
                
                // æ»šåŠ¨åˆ°é…ç½®åŒºåŸŸ
                configSection.scrollIntoView({ behavior: 'smooth' });
            }
        };

        // æ‰¹é‡æå–è¯¦æƒ… - ä½¿ç”¨ç»Ÿä¸€æœç´¢ç®¡ç†å™¨
        window.batchExtractDetails = function() {
            if (window.app && window.app.batchExtractDetails) {
                window.app.batchExtractDetails();
            }
        };

        // åˆ·æ–°è¯¦æƒ…æå–ç»Ÿè®¡
        window.refreshExtractionStats = function() {
            if (window.app && window.app.refreshDetailExtractionStats) {
                window.app.refreshDetailExtractionStats();
            }
        };

        // ğŸ†• é‚®ç®±éªŒè¯ç›¸å…³å…¨å±€å‡½æ•°
        window.emailVerificationUI = emailVerificationUI;
        
        // æ˜¾ç¤ºé‚®ç®±éªŒè¯ç›¸å…³æ¨¡æ€æ¡†çš„å…¨å±€å‡½æ•°
        window.showRegistrationVerificationModal = function(email) {
            emailVerificationUI.showRegistrationVerificationModal(email);
        };
        
        window.showPasswordResetModal = function() {
            emailVerificationUI.showPasswordResetModal();
        };

        // ğŸ†• æ˜¾ç¤ºå¿˜è®°å¯†ç æ¨¡æ€æ¡†çš„å…¨å±€å‡½æ•°
        window.showForgotPasswordModal = function() {
            emailVerificationUI.showForgotPasswordModal();
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–åº”ç”¨...');

            try {
                // æ›´æ–°é¡µé¢æ ‡é¢˜ä¸å“ç‰Œåç§°
                if (window.API_CONFIG) {
                    const appName = window.API_CONFIG.APP_NAME || 'ç£åŠ›å¿«æœ';
                    document.getElementById('page-title').textContent = `${appName} - ä¸“ä¸šç‰ˆ`;
                    document.getElementById('brand-text').textContent = appName;
                    document.getElementById('hero-title').textContent = `${appName} - ä¸“ä¸šç‰ˆ`;
                }
                
                // åˆ›å»ºä½¿ç”¨ç»Ÿä¸€æœç´¢ç»„ä»¶çš„åº”ç”¨å®ä¾‹
                window.app = new MagnetSearchApp();
                
                // ğŸ†• åˆå§‹åŒ–é‚®ç®±éªŒè¯UI
                initEmailVerificationIntegration();
                
                // åˆå§‹åŒ–é…ç½®ç®¡ç†UI
                initConfigManagementUI();
                
                console.log('âœ… åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
                const errorDiv = document.createElement('div');
                errorDiv.className = 'init-error';
                errorDiv.innerHTML = `
                    <div style="background: #fee; border: 1px solid #f00; padding: 1rem; margin: 1rem; border-radius: 4px;">
                        <h3>âš ï¸ åº”ç”¨åˆå§‹åŒ–å¤±è´¥</h3>
                        <p>é”™è¯¯ä¿¡æ¯ï¼š${error.message}</p>
                        <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼Œæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚</p>
                        <button onclick="window.location.reload()" style="padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            åˆ·æ–°é¡µé¢
                        </button>
                    </div>
                `;
                document.body.insertBefore(errorDiv, document.body.firstChild);
            }
        });

        // ğŸ†• åˆå§‹åŒ–é‚®ç®±éªŒè¯é›†æˆ
        function initEmailVerificationIntegration() {
            console.log('ğŸ“§ åˆå§‹åŒ–é‚®ç®±éªŒè¯é›†æˆ...');
            
            // ä¿®æ”¹æ³¨å†Œè¡¨å•æäº¤å¤„ç†
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const username = document.getElementById('regUsername').value.trim();
                    const email = document.getElementById('regEmail').value.trim();
                    const password = document.getElementById('regPassword').value;
                    const confirmPassword = document.getElementById('regConfirmPassword').value;
                    
                    // å®¢æˆ·ç«¯éªŒè¯
                    if (!username || !email || !password || !confirmPassword) {
                        showToast('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        showToast('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        showToast('å¯†ç é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦', 'error');
                        return;
                    }
                    
                    // é‚®ç®±æ ¼å¼éªŒè¯
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€', 'error');
                        return;
                    }
                    
                    try {
                        // å…³é—­æ³¨å†Œæ¨¡æ€æ¡†
                        document.getElementById('registerModal').style.display = 'none';
                        
                        // å­˜å‚¨æ³¨å†Œæ•°æ®ä¾›éªŒè¯æ—¶ä½¿ç”¨
                        emailVerificationUI.verificationData = {
                            username,
                            email,
                            password
                        };
                        
                        // æ˜¾ç¤ºé‚®ç®±éªŒè¯æ¨¡æ€æ¡†
                        emailVerificationUI.showRegistrationVerificationModal(email);
                        
                    } catch (error) {
                        console.error('æ³¨å†Œæµç¨‹å¯åŠ¨å¤±è´¥:', error);
                        showToast('æ³¨å†Œå¤±è´¥: ' + error.message, 'error');
                    }
                });
            }
            
            // ğŸ†• æ·»åŠ å¿˜è®°å¯†ç é“¾æ¥å¤„ç†ï¼ˆæ›´æ–°çš„IDï¼‰
            const showForgotPasswordLink = document.getElementById('showForgotPassword');
            if (showForgotPasswordLink) {
                showForgotPasswordLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('loginModal').style.display = 'none';
                    emailVerificationUI.showForgotPasswordModal();
                });
            }
            
            // ä¿æŒå‘åå…¼å®¹çš„æ—§IDå¤„ç†
            const showPasswordResetLink = document.getElementById('showPasswordReset');
            if (showPasswordResetLink) {
                showPasswordResetLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('loginModal').style.display = 'none';
                    emailVerificationUI.showForgotPasswordModal();
                });
            }
            
            console.log('âœ… é‚®ç®±éªŒè¯é›†æˆå®Œæˆ');
        }

        // åˆå§‹åŒ–é…ç½®ç®¡ç†UI
        function initConfigManagementUI() {
            // é…ç½®ç®¡ç†æŒ‰é’®
            const configManagementBtn = document.getElementById('configManagementBtn');
            if (configManagementBtn) {
                configManagementBtn.addEventListener('click', window.openConfigManagement);
            }

            // æ˜¾ç¤ºé…ç½®æŒ‰é’®
            const showConfigBtn = document.getElementById('showConfigBtn');
            if (showConfigBtn) {
                showConfigBtn.addEventListener('click', () => {
                    const configSection = document.getElementById('searchConfigSection');
                    const configContainer = document.getElementById('searchConfigContainer');
                    const hideConfigBtn = document.getElementById('hideConfigBtn');
                    
                    if (configSection && configContainer) {
                        configSection.style.display = 'block';
                        configContainer.style.display = 'block';
                        showConfigBtn.style.display = 'none';
                        if (hideConfigBtn) hideConfigBtn.style.display = 'inline-flex';
                        
                        // åˆå§‹åŒ–é…ç½®UI
                        if (window.unifiedSearchManager && window.unifiedSearchManager.configManager) {
                            window.unifiedSearchManager.configManager.initConfigUI('searchConfigContainer');
                        }
                    }
                });
            }

            // éšè—é…ç½®æŒ‰é’®
            const hideConfigBtn = document.getElementById('hideConfigBtn');
            if (hideConfigBtn) {
                hideConfigBtn.addEventListener('click', () => {
                    const configContainer = document.getElementById('searchConfigContainer');
                    const showConfigBtn = document.getElementById('showConfigBtn');
                    
                    if (configContainer) {
                        configContainer.style.display = 'none';
                        hideConfigBtn.style.display = 'none';
                        if (showConfigBtn) showConfigBtn.style.display = 'inline-flex';
                    }
                });
            }

            // æ‰¹é‡æå–æŒ‰é’®
            const batchExtractBtn = document.getElementById('batchExtractBtn');
            if (batchExtractBtn) {
                batchExtractBtn.addEventListener('click', window.batchExtractDetails);
            }

            // åˆ·æ–°ç»Ÿè®¡æŒ‰é’®
            const refreshStatsBtn = document.getElementById('refreshStatsBtn');
            if (refreshStatsBtn) {
                refreshStatsBtn.addEventListener('click', window.refreshExtractionStats);
            }

            // ç›‘å¬é…ç½®å˜æ›´äº‹ä»¶
            document.addEventListener('searchConfigChanged', handleSearchConfigChanged);
            document.addEventListener('detailConfigSaved', handleDetailConfigSaved);
        }

        // å¤„ç†æœç´¢é…ç½®å˜æ›´
        function handleSearchConfigChanged(event) {
            console.log('æœç´¢é…ç½®å·²å˜æ›´:', event.detail);
            
            // æ›´æ–°UIçŠ¶æ€
            updateConfigRelatedUI(event.detail.config);
        }

        // å¤„ç†è¯¦æƒ…é…ç½®ä¿å­˜
        function handleDetailConfigSaved(event) {
            console.log('è¯¦æƒ…é…ç½®å·²ä¿å­˜:', event.detail);
            
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¿å­˜åçš„å¤„ç†é€»è¾‘
            showToast('é…ç½®å·²ä¿å­˜å¹¶ç”Ÿæ•ˆ', 'success');
        }

        // æ›´æ–°é…ç½®ç›¸å…³UI
        function updateConfigRelatedUI(config) {
            // æ›´æ–°å¯¼èˆªæ ä¸­çš„é…ç½®ç®¡ç†æŒ‰é’®æ˜¾ç¤º
            const configManagementBtn = document.getElementById('configManagementBtn');
            if (configManagementBtn && window.app && window.app.currentUser) {
                configManagementBtn.style.display = 'inline-block';
            }
            
            // æ ¹æ®é…ç½®æ›´æ–°å…¶ä»–UIå…ƒç´ 
            if (config.enableDetailExtraction) {
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è¯¦æƒ…æå–å¯ç”¨åçš„UIæ›´æ–°é€»è¾‘
                console.log('è¯¦æƒ…æå–åŠŸèƒ½å·²å¯ç”¨');
            }
        }

        // æ˜¾ç¤ºToasté€šçŸ¥çš„ç®€å•å®ç°
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.style.display = 'block';
                
                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        }

        // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && window.app) {
                setTimeout(() => {
                    if (window.app.isInitialized) {
                        window.app.checkConnectionStatus();
                    }
                }, 100);
            }
        });

        // æœåŠ¡æ¶æ„å¥åº·æ£€æŸ¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    if (window.servicesManager) {
                        window.servicesManager.performHealthCheck().then(status => {
                            console.log('ğŸ©º æœåŠ¡å¥åº·æ£€æŸ¥ç»“æœ:', status);
                        }).catch(console.error);
                    }
                }, 2000);
            });
        }
    </script>
</body>
</html>