name = "codeseek-site"
main = "src/index.js"
compatibility_date = "2024-03-18"
workers_dev = true

[env.production]
name = "codeseek-site"
route = "https://all.omnibox.pp.ua/*"

[env.staging]
name = "codeseek-site-staging"

# 环境变量配置
[vars]
# 基础配置
ENVIRONMENT = "production"
DEBUG = "false"

# 代理配置
ALLOW_DIRECT_ACCESS = "true"
ENABLE_FAILOVER = "true"
FAILOVER_TIMEOUT = "5000"
MAX_REDIRECTS = "10"
REQUEST_TIMEOUT = "30000"

# 安全配置
BLOCK_MALICIOUS_SCRIPTS = "true"
SANITIZE_HTML = "true"
BLOCK_ADS = "true"
MAX_CONTENT_SIZE = "52428800"  # 50MB
BLOCK_EXTERNAL_REDIRECTS = "false"

# 缓存配置
ENABLE_SMART_CACHING = "true"
CACHE_HTML_TTL = "300000"      # 5分钟
CACHE_CSS_TTL = "3600000"      # 1小时
CACHE_JS_TTL = "3600000"       # 1小时
CACHE_IMAGE_TTL = "86400000"   # 24小时
CACHE_FONT_TTL = "604800000"   # 7天
CACHE_MAX_SIZE = "10485760"    # 10MB

# 处理器配置
HTML_INJECT_PROXY_SCRIPT = "true"
HTML_REWRITE_URLS = "true"
HTML_PROCESS_FORMS = "true"
HTML_HANDLE_WEBSOCKETS = "true"
CSS_REWRITE_URLS = "true"
CSS_PROCESS_IMPORTS = "true"
CSS_HANDLE_FONTS = "true"
JS_REWRITE_URLS = "true"
JS_HANDLE_APIS = "true"
JS_PROCESS_MODULES = "true"

# 特殊处理
MAGNET_LINKS = "true"
DOWNLOAD_LINKS = "true"
TORRENT_FILES = "true"
ED2K_LINKS = "true"
THUNDER_LINKS = "true"

# 额外的代理目标白名单（逗号分隔）
EXTRA_PROXY_TARGETS = ""

# 备用域名配置（逗号分隔）
BACKUP_DOMAINS = ""

# 开发环境变量
[env.development.vars]
ENVIRONMENT = "development"
DEBUG = "true"
ALLOW_DIRECT_ACCESS = "true"
ENABLE_FAILOVER = "false"

# 预览环境变量  
[env.preview.vars]
ENVIRONMENT = "preview"
DEBUG = "true"
ALLOW_DIRECT_ACCESS = "true"

# KV命名空间绑定（用于速率限制和缓存）
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "41e4a2ca358940bfa0dc6c18fc38016d"
preview_id = "41e4a2ca358940bfa0dc6c18fc38016d"

[[kv_namespaces]]
binding = "CACHE_KV"
id = "41e4a2ca358940bfa0dc6c18fc38016d" 
preview_id = "41e4a2ca358940bfa0dc6c18fc38016d"

# Durable Objects绑定（可选，用于高级功能）
# [[durable_objects.bindings]]
# name = "PROXY_SESSIONS"
# class_name = "ProxySession"

# 定时触发器配置 - 修复：使用正确的cron格式
[triggers]
crons = ["0 */6 * * *"]  # 每6小时清理一次缓存



# 部署配置
[build]
command = "echo 'No build step required for modular ES6'"
cwd = "."

# 兼容性标志 - 修复：使用字符串数组格式，只包含需要启用的标志
compatibility_flags = ["formdata_parser_supports_files"]